-- Test tag manipulation
\d+ pg_tag;
                                    Table "pg_catalog.pg_tag"
     Column     |  Type  | Collation | Nullable | Default | Storage  | Stats target | Description 
----------------+--------+-----------+----------+---------+----------+--------------+-------------
 oid            | oid    |           | not null |         | plain    |              | 
 tagname        | name   |           | not null |         | plain    |              | 
 tagowner       | oid    |           | not null |         | plain    |              | 
 allowed_values | text[] | C         |          |         | extended |              | 
Indexes:
    "pg_tag_tagname_index" PRIMARY KEY, btree (tagname), tablespace "pg_global"
    "pg_tag_oid_index" UNIQUE CONSTRAINT, btree (oid), tablespace "pg_global"
Tablespace: "pg_global"

\d+ pg_tag_description;
                            Table "pg_catalog.pg_tag_description"
    Column    | Type | Collation | Nullable | Default | Storage  | Stats target | Description 
--------------+------+-----------+----------+---------+----------+--------------+-------------
 oid          | oid  |           | not null |         | plain    |              | 
 tddatabaseid | oid  |           | not null |         | plain    |              | 
 tdclassid    | oid  |           | not null |         | plain    |              | 
 tdobjid      | oid  |           | not null |         | plain    |              | 
 tagid        | oid  |           | not null |         | plain    |              | 
 tagvalue     | text | C         |          |         | extended |              | 
Indexes:
    "pg_tag_description_d_c_o_t_index" PRIMARY KEY, btree (tddatabaseid, tdclassid, tdobjid, tagid), tablespace "pg_global"
    "pg_tag_description_oid_index" UNIQUE CONSTRAINT, btree (oid), tablespace "pg_global"
    "pg_tag_description_tagidvalue_index" btree (tagid, tagvalue), tablespace "pg_global"
Tablespace: "pg_global"

SELECT * FROM pg_tag;
 oid | tagname | tagowner | allowed_values 
-----+---------+----------+----------------
(0 rows)

SELECT * FROM pg_tag_description;
 oid | tddatabaseid | tdclassid | tdobjid | tagid | tagvalue 
-----+--------------+-----------+---------+-------+----------
(0 rows)

CREATE DATABASE other_db;
-- Test create tag
CREATE TAG tag1;
CREATE TAG IF NOT EXISTS tag1;
NOTICE:  tag "tag1" already exists, skipping
CREATE TAG IF NOT EXISTS tag2;
CREATE TAG tag2;    -- error
ERROR:  tag "tag2" already exists
CREATE TAG tag3 ALLOWED_VALUES '123';
CREATE TAG tag3;    -- error
ERROR:  tag "tag3" already exists
CREATE TAG tag4 ALLOWED_VALUES '123', '456', ' ';
CREATE TAG IF NOT EXISTS tag5 ALLOWED_VALUES '123', 'val1';
CREATE TAG tag6 ALLOWED_VALUES 'nqwenfqpjenpjqnpufnqwpiuenfuiasqwefqfsafqwefnfiunl;jfa;lskdfjqpwefjqpewe234dfqwef'
'fjhsudfiueqihfsakdljfqeqfhqoufhoaisuehfqoiuwehfqoifhqoiuwehfoqihfosfqwfeqwfqwefqwefqwfefqefqfqewfqwefweqfsdfqwef'
'qifquhowifhoiuqhfuosdfqjfqkepfqjfpishdfuiqh2139u108wefoiuqwhefoiuqwehfoiuqwhfoiuweqfheiasuohfioquwehfqwoeiufhdas'
'iqeqwejfpqwifjipqwfjqwiefjpiqwehfpiquwehfqwiufhqwpiuefhqwui0fhpiiohfoqiuwehfoquwefoiweqfewoqifqwoiufhho';          -- error
ERROR:  added allowed value "nqwenfqpjenpjqnpufnqwpiuenfuiasqwefqfsafqwefnfiunl;jfa;lskdfjqpwefjqpewe234dfqweffjhsudfiueqihfsakdljfqeqfhqoufhoaisuehfqoiuwehfqoifhqoiuwehfoqihfosfqwfeqwfqwefqwefqwfefqefqfqewfqwefweqfsdfqwefqifquhowifhoiuqhfuosdfqjfqkepfqjfpishdfuiqh2139u108wefoiuqwhefoiuqwehfoiuqwhfoiuweqfheiasuohfioquwehfqwoeiufhdasiqeqwejfpqwifjipqwfjqwiefjpiqwehfpiquwehfqwiufhqwpiuefhqwui0fhpiiohfoqiuwehfoquwefoiweqfewoqifqwoiufhho" has exceeded max 256 length
CREATE TAG tag7 ALLOWED_VALUES 'val1', '123', 'val1';     -- error
ERROR:  allowed value "val1" has been added
CREATE TAG tag8 ALLOWED_VALUES '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', 
 '17',  '18',  '19',  '20',  '21',  '22',  '23',  '24',  '25',  '26',  '27',  '28',  '29',  '30',  '31',  '32',  '33',  '34',  '35',  '36',
 '37',  '38',  '39',  '40',  '41',  '42',  '43',  '44',  '45',  '46',  '47',  '48',  '49',  '50',  '51',  '52',  '53',  '54',  '55',  '56',
 '57',  '58',  '59',  '60',  '61',  '62',  '63',  '64',  '65',  '66',  '67',  '68',  '69',  '70',  '71',  '72',  '73',  '74',  '75',  '76',
 '77',  '78',  '79',  '80',  '81',  '82',  '83',  '84',  '85',  '86',  '87',  '88',  '89',  '90',  '91',  '92',  '93',  '94',  '95',  '96',
 '97',  '98',  '99', '100', '101', '102', '103', '104', '105', '106', '107', '108', '109', '110', '111', '112', '113', '114', '115', '116',
'117', '118', '119', '120', '121', '122', '123', '124', '125', '126', '127', '128', '129', '130', '131', '132', '133', '134', '135', '136',
'137', '138', '139', '140', '141', '142', '143', '144', '145', '146', '147', '148', '149', '150', '151', '152', '153', '154', '155', '156',
'157', '158', '159', '160', '161', '162', '163', '164', '165', '166', '167', '168', '169', '170', '171', '172', '173', '174', '175', '176',
'177', '178', '179', '180', '181', '182', '183', '184', '185', '186', '187', '188', '189', '190', '191', '192', '193', '194', '195', '196',
'197', '198', '199', '200', '201', '202', '203', '204', '205', '206', '207', '208', '209', '210', '211', '212', '213', '214', '215', '216',
'217', '218', '219', '220', '221', '222', '223', '224', '225', '226', '227', '228', '229', '230', '231', '232', '233', '234', '235', '236',
'237', '238', '239', '240', '241', '242', '243', '244', '245', '246', '247', '248', '249', '250', '251', '252', '253', '254', '255', '256',
'257', '258', '259', '260', '261', '262', '263', '264', '265', '266', '267', '268', '269', '270', '271', '272', '273', '274', '275', '276',
'277', '278', '279', '280', '281', '282', '283', '284', '285', '286', '287', '288', '289', '290', '291', '292', '293', '294', '295', '296',
'297', '298', '299', '300';
CREATE TAG tag9 ALLOWED_VALUES '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16',   -- error
 '17',  '18',  '19',  '20',  '21',  '22',  '23',  '24',  '25',  '26',  '27',  '28',  '29',  '30',  '31',  '32',  '33',  '34',  '35',  '36',
 '37',  '38',  '39',  '40',  '41',  '42',  '43',  '44',  '45',  '46',  '47',  '48',  '49',  '50',  '51',  '52',  '53',  '54',  '55',  '56',
 '57',  '58',  '59',  '60',  '61',  '62',  '63',  '64',  '65',  '66',  '67',  '68',  '69',  '70',  '71',  '72',  '73',  '74',  '75',  '76',
 '77',  '78',  '79',  '80',  '81',  '82',  '83',  '84',  '85',  '86',  '87',  '88',  '89',  '90',  '91',  '92',  '93',  '94',  '95',  '96',
 '97',  '98',  '99', '100', '101', '102', '103', '104', '105', '106', '107', '108', '109', '110', '111', '112', '113', '114', '115', '116',
'117', '118', '119', '120', '121', '122', '123', '124', '125', '126', '127', '128', '129', '130', '131', '132', '133', '134', '135', '136',
'137', '138', '139', '140', '141', '142', '143', '144', '145', '146', '147', '148', '149', '150', '151', '152', '153', '154', '155', '156',
'157', '158', '159', '160', '161', '162', '163', '164', '165', '166', '167', '168', '169', '170', '171', '172', '173', '174', '175', '176',
'177', '178', '179', '180', '181', '182', '183', '184', '185', '186', '187', '188', '189', '190', '191', '192', '193', '194', '195', '196',
'197', '198', '199', '200', '201', '202', '203', '204', '205', '206', '207', '208', '209', '210', '211', '212', '213', '214', '215', '216',
'217', '218', '219', '220', '221', '222', '223', '224', '225', '226', '227', '228', '229', '230', '231', '232', '233', '234', '235', '236',
'237', '238', '239', '240', '241', '242', '243', '244', '245', '246', '247', '248', '249', '250', '251', '252', '253', '254', '255', '256',
'257', '258', '259', '260', '261', '262', '263', '264', '265', '266', '267', '268', '269', '270', '271', '272', '273', '274', '275', '276',
'277', '278', '279', '280', '281', '282', '283', '284', '285', '286', '287', '288', '289', '290', '291', '292', '293', '294', '295', '296',
'297', '298', '299', '300', '301';
ERROR:  Allowed_values only allow 300 values.
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            allowed_values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 tag1    |       10 | 
 tag2    |       10 | 
 tag3    |       10 | {123}
 tag4    |       10 | {123,456," "}
 tag5    |       10 | {123,val1}
 tag8    |       10 | {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300}
(6 rows)

SELECT count(*) FROM pg_tag_description;
 count 
-------
     0
(1 row)

\c other_db
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            allowed_values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 tag1    |       10 | 
 tag2    |       10 | 
 tag3    |       10 | {123}
 tag4    |       10 | {123,456," "}
 tag5    |       10 | {123,val1}
 tag8    |       10 | {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300}
(6 rows)

SELECT count(*) FROM pg_tag_description;
 count 
-------
     0
(1 row)

\c postgres
-- Test Drop tag
DROP TAG tag5;
DROP TAG IF EXISTS tag5;
NOTICE:  tag "tag5" does not exist, skipping
DROP TAG IF EXISTS tag8;
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner | allowed_values 
---------+----------+----------------
 tag1    |       10 | 
 tag2    |       10 | 
 tag3    |       10 | {123}
 tag4    |       10 | {123,456," "}
(4 rows)

SELECT count(*) FROM pg_tag_description;
 count 
-------
     0
(1 row)

\c other_db
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner | allowed_values 
---------+----------+----------------
 tag1    |       10 | 
 tag2    |       10 | 
 tag3    |       10 | {123}
 tag4    |       10 | {123,456," "}
(4 rows)

SELECT count(*) FROM pg_tag_description;
 count 
-------
     0
(1 row)

\c postgres
-- Test Alter tag
-- Rename
ALTER TAG tag3 RENAME TO tag3_new;
ALTER TAG IF EXISTS tag4 RENAME TO tag4_new;
ALTER TAG tag3_new RENAME TO tag3;
ALTER TAG tag4_new RENAME TO tag4;
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner | allowed_values 
---------+----------+----------------
 tag1    |       10 | 
 tag2    |       10 | 
 tag3    |       10 | {123}
 tag4    |       10 | {123,456," "}
(4 rows)

SELECT count(*) FROM pg_tag_description;
 count 
-------
     0
(1 row)

\c other_db
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner | allowed_values 
---------+----------+----------------
 tag1    |       10 | 
 tag2    |       10 | 
 tag3    |       10 | {123}
 tag4    |       10 | {123,456," "}
(4 rows)

SELECT count(*) FROM pg_tag_description;
 count 
-------
     0
(1 row)

\c postgres
-- OWNER TO
CREATE USER tag_user;
NOTICE:  resource queue required -- using default resource queue "pg_default"
ALTER TAG tag1 OWNER TO tag_user;
SELECT tagname, rolname AS tagowner, allowed_values FROM pg_tag, pg_authid
WHERE pg_tag.tagowner = pg_authid.oid
ORDER BY 1;
 tagname | tagowner | allowed_values 
---------+----------+----------------
 tag1    | tag_user | 
 tag2    | gpadmin  | 
 tag3    | gpadmin  | {123}
 tag4    | gpadmin  | {123,456," "}
(4 rows)

ALTER TAG tag1 OWNER TO gpadmin;
SELECT tagname, rolname AS tagowner, allowed_values FROM pg_tag, pg_authid
WHERE pg_tag.tagowner = pg_authid.oid
ORDER BY 1;
 tagname | tagowner | allowed_values 
---------+----------+----------------
 tag1    | gpadmin  | 
 tag2    | gpadmin  | 
 tag3    | gpadmin  | {123}
 tag4    | gpadmin  | {123,456," "}
(4 rows)

\c other_db
SELECT tagname, rolname AS tagowner, allowed_values FROM pg_tag, pg_authid
WHERE pg_tag.tagowner = pg_authid.oid
ORDER BY 1;
 tagname | tagowner | allowed_values 
---------+----------+----------------
 tag1    | gpadmin  | 
 tag2    | gpadmin  | 
 tag3    | gpadmin  | {123}
 tag4    | gpadmin  | {123,456," "}
(4 rows)

\c postgres
-- Unset allowed_values
ALTER TAG tag1 UNSET ALLOWED_VALUES;
ALTER TAG tag2 UNSET ALLOWED_VALUES;
ALTER TAG tag3 UNSET ALLOWED_VALUES;
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner | allowed_values 
---------+----------+----------------
 tag1    |       10 | 
 tag2    |       10 | 
 tag3    |       10 | 
 tag4    |       10 | {123,456," "}
(4 rows)

SELECT count(*) FROM pg_tag_description;
 count 
-------
     0
(1 row)

\c other_db
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner | allowed_values 
---------+----------+----------------
 tag1    |       10 | 
 tag2    |       10 | 
 tag3    |       10 | 
 tag4    |       10 | {123,456," "}
(4 rows)

SELECT count(*) FROM pg_tag_description;
 count 
-------
     0
(1 row)

\c postgres
-- ADD allowed_values
ALTER TAG tag1 ADD ALLOWED_VALUES 'val1';
ALTER TAG tag1 ADD ALLOWED_VALUES 'val1';   -- error
ERROR:  allowed value "val1" has been added
ALTER TAG IF EXISTS tag1 ADD ALLOWED_VALUES 'val1';  -- error
ERROR:  allowed value "val1" has been added
ALTER TAG tag1 ADD ALLOWED_VALUES 'val2', 'val2';   -- error
ERROR:  allowed value "val2" has been added
ALTER TAG IF EXISTS tag1 ADD ALLOWED_VALUES 'val2', 'val2';   -- error
ERROR:  allowed value "val2" has been added
ALTER TAG tag1 ADD ALLOWED_VALUES 'val2', 'val3';
ALTER TAG IF EXISTS tag1 ADD ALLOWED_VALUES 'val4', 'val5';
ALTER TAG tag1 ADD ALLOWED_VALUES '', '';   -- error
ERROR:  allowed value "" has been added
ALTER TAG IF EXISTS tag1 ADD ALLOWED_VALUES '', ''; --error
ERROR:  allowed value "" has been added
ALTER TAG tag1 ADD ALLOWED_VALUES ' ', ' '; -- error
ERROR:  allowed value " " has been added
ALTER TAG IF EXISTS tag1 ADD ALLOWED_VALUES ' ';
ALTER TAG tag1 ADD ALLOWED_VALUES '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16',    -- error
 '17',  '18',  '19',  '20',  '21',  '22',  '23',  '24',  '25',  '26',  '27',  '28',  '29',  '30',  '31',  '32',  '33',  '34',  '35',  '36',
 '37',  '38',  '39',  '40',  '41',  '42',  '43',  '44',  '45',  '46',  '47',  '48',  '49',  '50',  '51',  '52',  '53',  '54',  '55',  '56',
 '57',  '58',  '59',  '60',  '61',  '62',  '63',  '64',  '65',  '66',  '67',  '68',  '69',  '70',  '71',  '72',  '73',  '74',  '75',  '76',
 '77',  '78',  '79',  '80',  '81',  '82',  '83',  '84',  '85',  '86',  '87',  '88',  '89',  '90',  '91',  '92',  '93',  '94',  '95',  '96',
 '97',  '98',  '99', '100', '101', '102', '103', '104', '105', '106', '107', '108', '109', '110', '111', '112', '113', '114', '115', '116',
'117', '118', '119', '120', '121', '122', '123', '124', '125', '126', '127', '128', '129', '130', '131', '132', '133', '134', '135', '136',
'137', '138', '139', '140', '141', '142', '143', '144', '145', '146', '147', '148', '149', '150', '151', '152', '153', '154', '155', '156',
'157', '158', '159', '160', '161', '162', '163', '164', '165', '166', '167', '168', '169', '170', '171', '172', '173', '174', '175', '176',
'177', '178', '179', '180', '181', '182', '183', '184', '185', '186', '187', '188', '189', '190', '191', '192', '193', '194', '195', '196',
'197', '198', '199', '200', '201', '202', '203', '204', '205', '206', '207', '208', '209', '210', '211', '212', '213', '214', '215', '216',
'217', '218', '219', '220', '221', '222', '223', '224', '225', '226', '227', '228', '229', '230', '231', '232', '233', '234', '235', '236',
'237', '238', '239', '240', '241', '242', '243', '244', '245', '246', '247', '248', '249', '250', '251', '252', '253', '254', '255', '256',
'257', '258', '259', '260', '261', '262', '263', '264', '265', '266', '267', '268', '269', '270', '271', '272', '273', '274', '275', '276',
'277', '278', '279', '280', '281', '282', '283', '284', '285', '286', '287', '288', '289', '290', '291', '292', '293', '294', '295', '296',
'297', '298', '299', '300';
ERROR:  Allowed_values only allow 300 values.
ALTER TAG IF EXISTS tag1 ADD ALLOWED_VALUES '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16',    -- error
 '17',  '18',  '19',  '20',  '21',  '22',  '23',  '24',  '25',  '26',  '27',  '28',  '29',  '30',  '31',  '32',  '33',  '34',  '35',  '36',
 '37',  '38',  '39',  '40',  '41',  '42',  '43',  '44',  '45',  '46',  '47',  '48',  '49',  '50',  '51',  '52',  '53',  '54',  '55',  '56',
 '57',  '58',  '59',  '60',  '61',  '62',  '63',  '64',  '65',  '66',  '67',  '68',  '69',  '70',  '71',  '72',  '73',  '74',  '75',  '76',
 '77',  '78',  '79',  '80',  '81',  '82',  '83',  '84',  '85',  '86',  '87',  '88',  '89',  '90',  '91',  '92',  '93',  '94',  '95',  '96',
 '97',  '98',  '99', '100', '101', '102', '103', '104', '105', '106', '107', '108', '109', '110', '111', '112', '113', '114', '115', '116',
'117', '118', '119', '120', '121', '122', '123', '124', '125', '126', '127', '128', '129', '130', '131', '132', '133', '134', '135', '136',
'137', '138', '139', '140', '141', '142', '143', '144', '145', '146', '147', '148', '149', '150', '151', '152', '153', '154', '155', '156',
'157', '158', '159', '160', '161', '162', '163', '164', '165', '166', '167', '168', '169', '170', '171', '172', '173', '174', '175', '176',
'177', '178', '179', '180', '181', '182', '183', '184', '185', '186', '187', '188', '189', '190', '191', '192', '193', '194', '195', '196',
'197', '198', '199', '200', '201', '202', '203', '204', '205', '206', '207', '208', '209', '210', '211', '212', '213', '214', '215', '216',
'217', '218', '219', '220', '221', '222', '223', '224', '225', '226', '227', '228', '229', '230', '231', '232', '233', '234', '235', '236',
'237', '238', '239', '240', '241', '242', '243', '244', '245', '246', '247', '248', '249', '250', '251', '252', '253', '254', '255', '256',
'257', '258', '259', '260', '261', '262', '263', '264', '265', '266', '267', '268', '269', '270', '271', '272', '273', '274', '275', '276',
'277', '278', '279', '280', '281', '282', '283', '284', '285', '286', '287', '288', '289', '290', '291', '292', '293', '294', '295', '296',
'297', '298', '299', '300';
ERROR:  Allowed_values only allow 300 values.
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner |         allowed_values         
---------+----------+--------------------------------
 tag1    |       10 | {val1,val2,val3,val4,val5," "}
 tag2    |       10 | 
 tag3    |       10 | 
 tag4    |       10 | {123,456," "}
(4 rows)

SELECT count(*) FROM pg_tag_description;
 count 
-------
     0
(1 row)

\c other_db
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner |         allowed_values         
---------+----------+--------------------------------
 tag1    |       10 | {val1,val2,val3,val4,val5," "}
 tag2    |       10 | 
 tag3    |       10 | 
 tag4    |       10 | {123,456," "}
(4 rows)

SELECT count(*) FROM pg_tag_description;
 count 
-------
     0
(1 row)

\c postgres
ALTER TAG tag2 ADD ALLOWED_VALUES '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16',
 '17',  '18',  '19',  '20',  '21',  '22',  '23',  '24',  '25',  '26',  '27',  '28',  '29',  '30',  '31',  '32',  '33',  '34',  '35',  '36',
 '37',  '38',  '39',  '40',  '41',  '42',  '43',  '44',  '45',  '46',  '47',  '48',  '49',  '50',  '51',  '52',  '53',  '54',  '55',  '56',
 '57',  '58',  '59',  '60',  '61',  '62',  '63',  '64',  '65',  '66',  '67',  '68',  '69',  '70',  '71',  '72',  '73',  '74',  '75',  '76',
 '77',  '78',  '79',  '80',  '81',  '82',  '83',  '84',  '85',  '86',  '87',  '88',  '89',  '90',  '91',  '92',  '93',  '94',  '95',  '96',
 '97',  '98',  '99', '100', '101', '102', '103', '104', '105', '106', '107', '108', '109', '110', '111', '112', '113', '114', '115', '116',
'117', '118', '119', '120', '121', '122', '123', '124', '125', '126', '127', '128', '129', '130', '131', '132', '133', '134', '135', '136',
'137', '138', '139', '140', '141', '142', '143', '144', '145', '146', '147', '148', '149', '150', '151', '152', '153', '154', '155', '156',
'157', '158', '159', '160', '161', '162', '163', '164', '165', '166', '167', '168', '169', '170', '171', '172', '173', '174', '175', '176',
'177', '178', '179', '180', '181', '182', '183', '184', '185', '186', '187', '188', '189', '190', '191', '192', '193', '194', '195', '196',
'197', '198', '199', '200', '201', '202', '203', '204', '205', '206', '207', '208', '209', '210', '211', '212', '213', '214', '215', '216',
'217', '218', '219', '220', '221', '222', '223', '224', '225', '226', '227', '228', '229', '230', '231', '232', '233', '234', '235', '236',
'237', '238', '239', '240', '241', '242', '243', '244', '245', '246', '247', '248', '249', '250', '251', '252', '253', '254', '255', '256',
'257', '258', '259', '260', '261', '262', '263', '264', '265', '266', '267', '268', '269', '270', '271', '272', '273', '274', '275', '276',
'277', '278', '279', '280', '281', '282', '283', '284', '285', '286', '287', '288', '289', '290', '291', '292', '293', '294', '295', '296',
'297', '298', '299', '300';
ALTER TAG IF EXISTS tag2 ADD ALLOWED_VALUES '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16',    -- error
 '17',  '18',  '19',  '20',  '21',  '22',  '23',  '24',  '25',  '26',  '27',  '28',  '29',  '30',  '31',  '32',  '33',  '34',  '35',  '36',
 '37',  '38',  '39',  '40',  '41',  '42',  '43',  '44',  '45',  '46',  '47',  '48',  '49',  '50',  '51',  '52',  '53',  '54',  '55',  '56',
 '57',  '58',  '59',  '60',  '61',  '62',  '63',  '64',  '65',  '66',  '67',  '68',  '69',  '70',  '71',  '72',  '73',  '74',  '75',  '76',
 '77',  '78',  '79',  '80',  '81',  '82',  '83',  '84',  '85',  '86',  '87',  '88',  '89',  '90',  '91',  '92',  '93',  '94',  '95',  '96',
 '97',  '98',  '99', '100', '101', '102', '103', '104', '105', '106', '107', '108', '109', '110', '111', '112', '113', '114', '115', '116',
'117', '118', '119', '120', '121', '122', '123', '124', '125', '126', '127', '128', '129', '130', '131', '132', '133', '134', '135', '136',
'137', '138', '139', '140', '141', '142', '143', '144', '145', '146', '147', '148', '149', '150', '151', '152', '153', '154', '155', '156',
'157', '158', '159', '160', '161', '162', '163', '164', '165', '166', '167', '168', '169', '170', '171', '172', '173', '174', '175', '176',
'177', '178', '179', '180', '181', '182', '183', '184', '185', '186', '187', '188', '189', '190', '191', '192', '193', '194', '195', '196',
'197', '198', '199', '200', '201', '202', '203', '204', '205', '206', '207', '208', '209', '210', '211', '212', '213', '214', '215', '216',
'217', '218', '219', '220', '221', '222', '223', '224', '225', '226', '227', '228', '229', '230', '231', '232', '233', '234', '235', '236',
'237', '238', '239', '240', '241', '242', '243', '244', '245', '246', '247', '248', '249', '250', '251', '252', '253', '254', '255', '256',
'257', '258', '259', '260', '261', '262', '263', '264', '265', '266', '267', '268', '269', '270', '271', '272', '273', '274', '275', '276',
'277', '278', '279', '280', '281', '282', '283', '284', '285', '286', '287', '288', '289', '290', '291', '292', '293', '294', '295', '296',
'297', '298', '299', '300';
ERROR:  allowed value "1" has been added
ALTER TAG tag3 ADD ALLOWED_VALUES 'nqwenfqpjenpjqnpufnqwpiuenfuiasqwefqfsafqwefnfiunl;jfa;lskdfjqpwefjqpewe234dfqwef'
'fjhsudfiueqihfsakdljfqeqfhqoufhoaisuehfqoiuwehfqoifhqoiuwehfoqihfosfqwfeqwfqwefqwefqwfefqefqfqewfqwefweqfsdfqwef'
'qifquhowifhoiuqhfuosdfqjfqkepfqjfpishdfuiqh2139u108wefoiuqwhefoiuqwehfoiuqwhfoiuweqfheiasuohfioquwehfqwoeiufhdas'
'iqeqwejfpqwifjipqwfjqwiefjpiqwehfpiquwehfqwiufhqwpiuefhqwui0fhpiiohfoqiuwehfoquwefoiweqfewoqifqwoiufhho';  -- error
ERROR:  added allowed value "nqwenfqpjenpjqnpufnqwpiuenfuiasqwefqfsafqwefnfiunl;jfa;lskdfjqpwefjqpewe234dfqweffjhsudfiueqihfsakdljfqeqfhqoufhoaisuehfqoiuwehfqoifhqoiuwehfoqihfosfqwfeqwfqwefqwefqwfefqefqfqewfqwefweqfsdfqwefqifquhowifhoiuqhfuosdfqjfqkepfqjfpishdfuiqh2139u108wefoiuqwhefoiuqwehfoiuqwhfoiuweqfheiasuohfioquwehfqwoeiufhdasiqeqwejfpqwifjipqwfjqwiefjpiqwehfpiquwehfqwiufhqwpiuefhqwui0fhpiiohfoqiuwehfoquwefoiweqfewoqifqwoiufhho" has exceeded max 256 length
ALTER TAG IF EXISTS tag3 ADD ALLOWED_VALUES 'nqwenfqpjenpjqnpufnqwpiuenfuiasqwefqfsafqwefnfiunl;jfa;lskdfjqpwefjqpewe234dfqwef'
'fjhsudfiueqihfsakdljfqeqfhqoufhoaisuehfqoiuwehfqoifhqoiuwehfoqihfosfqwfeqwfqwefqwefqwfefqefqfqewfqwefweqfsdfqwef'
'qifquhowifhoiuqhfuosdfqjfqkepfqjfpishdfuiqh2139u108wefoiuqwhefoiuqwehfoiuqwhfoiuweqfheiasuohfioquwehfqwoeiufhdas'
'iqeqwejfpqwifjipqwfjqwiefjpiqwehfpiquwehfqwiufhqwpiuefhqwui0fhpiiohfoqiuwehfoquwefoiweqfewoqifqwoiufhho';  -- error
ERROR:  added allowed value "nqwenfqpjenpjqnpufnqwpiuenfuiasqwefqfsafqwefnfiunl;jfa;lskdfjqpwefjqpewe234dfqweffjhsudfiueqihfsakdljfqeqfhqoufhoaisuehfqoiuwehfqoifhqoiuwehfoqihfosfqwfeqwfqwefqwefqwfefqefqfqewfqwefweqfsdfqwefqifquhowifhoiuqhfuosdfqjfqkepfqjfpishdfuiqh2139u108wefoiuqwhefoiuqwehfoiuqwhfoiuweqfheiasuohfioquwehfqwoeiufhdasiqeqwejfpqwifjipqwfjqwiefjpiqwehfpiquwehfqwiufhqwpiuefhqwui0fhpiiohfoqiuwehfoquwefoiweqfewoqifqwoiufhho" has exceeded max 256 length
ALTER TAG tag3 ADD ALLOWED_VALUES 'dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef';
ALTER TAG tag4 ADD ALLOWED_VALUES ' ';  -- error
ERROR:  allowed value " " has been added
ALTER TAG IF EXISTS tag4 ADD ALLOWED_VALUES ' ';  -- error
ERROR:  allowed value " " has been added
ALTER TAG tag4 ADD ALLOWED_VALUES '';
ALTER TAG tag4 ADD ALLOWED_VALUES '';   -- error
ERROR:  allowed value "" has been added
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            allowed_values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 tag1    |       10 | {val1,val2,val3,val4,val5," "}
 tag2    |       10 | {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300}
 tag3    |       10 | {dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef}
 tag4    |       10 | {123,456," ",""}
(4 rows)

SELECT count(*) FROM pg_tag_description;
 count 
-------
     0
(1 row)

\c other_db
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            allowed_values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 tag1    |       10 | {val1,val2,val3,val4,val5," "}
 tag2    |       10 | {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300}
 tag3    |       10 | {dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef}
 tag4    |       10 | {123,456," ",""}
(4 rows)

SELECT count(*) FROM pg_tag_description;
 count 
-------
     0
(1 row)

\c postgres
-- DROP allowed_values
ALTER TAG tag1 DROP ALLOWED_VALUES 'unknown';    -- error;
ERROR:  allowed value "unknown" not found
ALTER TAG IF EXISTS tag1 DROP ALLOWED_VALUES 'unknown';    -- error;
ERROR:  allowed value "unknown" not found
ALTER TAG IF EXISTS tag1 DROP ALLOWED_VALUES '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16',    -- error
 '17',  '18',  '19',  '20',  '21',  '22',  '23',  '24',  '25',  '26',  '27',  '28',  '29',  '30',  '31',  '32',  '33',  '34',  '35',  '36',
 '37',  '38',  '39',  '40',  '41',  '42',  '43',  '44',  '45',  '46',  '47',  '48',  '49',  '50',  '51',  '52',  '53',  '54',  '55',  '56',
 '57',  '58',  '59',  '60',  '61',  '62',  '63',  '64',  '65',  '66',  '67',  '68',  '69',  '70',  '71',  '72',  '73',  '74',  '75',  '76',
 '77',  '78',  '79',  '80',  '81',  '82',  '83',  '84',  '85',  '86',  '87',  '88',  '89',  '90',  '91',  '92',  '93',  '94',  '95',  '96',
 '97',  '98',  '99', '100', '101', '102', '103', '104', '105', '106', '107', '108', '109', '110', '111', '112', '113', '114', '115', '116',
'117', '118', '119', '120', '121', '122', '123', '124', '125', '126', '127', '128', '129', '130', '131', '132', '133', '134', '135', '136',
'137', '138', '139', '140', '141', '142', '143', '144', '145', '146', '147', '148', '149', '150', '151', '152', '153', '154', '155', '156',
'157', '158', '159', '160', '161', '162', '163', '164', '165', '166', '167', '168', '169', '170', '171', '172', '173', '174', '175', '176',
'177', '178', '179', '180', '181', '182', '183', '184', '185', '186', '187', '188', '189', '190', '191', '192', '193', '194', '195', '196',
'197', '198', '199', '200', '201', '202', '203', '204', '205', '206', '207', '208', '209', '210', '211', '212', '213', '214', '215', '216',
'217', '218', '219', '220', '221', '222', '223', '224', '225', '226', '227', '228', '229', '230', '231', '232', '233', '234', '235', '236',
'237', '238', '239', '240', '241', '242', '243', '244', '245', '246', '247', '248', '249', '250', '251', '252', '253', '254', '255', '256',
'257', '258', '259', '260', '261', '262', '263', '264', '265', '266', '267', '268', '269', '270', '271', '272', '273', '274', '275', '276',
'277', '278', '279', '280', '281', '282', '283', '284', '285', '286', '287', '288', '289', '290', '291', '292', '293', '294', '295', '296',
'297', '298', '299', '300';
ERROR:  allowed value "1" not found
ALTER TAG tag1 DROP ALLOWED_VALUES '1'; -- error
ERROR:  allowed value "1" not found
ALTER TAG IF EXISTS tag1 DROP ALLOWED_VALUES '1'; -- error
ERROR:  allowed value "1" not found
ALTER TAG tag1 DROP ALLOWED_VALUES '';  -- error
ERROR:  allowed value "" not found
ALTER TAG IF EXISTS tag1 DROP ALLOWED_VALUES '';  -- error
ERROR:  allowed value "" not found
ALTER TAG tag1 UNSET ALLOWED_VALUES;
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            allowed_values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 tag1    |       10 | 
 tag2    |       10 | {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300}
 tag3    |       10 | {dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef}
 tag4    |       10 | {123,456," ",""}
(4 rows)

ALTER TAG tag1 ADD ALLOWED_VALUES 'val1', 'val2', 'val3';
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            allowed_values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 tag1    |       10 | {val1,val2,val3}
 tag2    |       10 | {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300}
 tag3    |       10 | {dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef}
 tag4    |       10 | {123,456," ",""}
(4 rows)

SELECT count(*) FROM pg_tag_description;
 count 
-------
     0
(1 row)

\c other_db
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            allowed_values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 tag1    |       10 | {val1,val2,val3}
 tag2    |       10 | {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300}
 tag3    |       10 | {dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef}
 tag4    |       10 | {123,456," ",""}
(4 rows)

SELECT count(*) FROM pg_tag_description;
 count 
-------
     0
(1 row)

\c postgres
-- Cleanup
DROP USER tag_user;
-- Test database with tag
-- Create database
CREATE DATABASE tag_db1 TAG (tag1 = 'novalue'); -- error
ERROR:  tag value "novalue" is not in tag "tag1" allowed values
CREATE DATABASE tag_db1 TAG (tag1 = 'val1');
CREATE DATABASE tag_db2 TAG;    -- error
ERROR:  syntax error at or near ";"
LINE 1: CREATE DATABASE tag_db2 TAG;
                                   ^
CREATE DATABASE tag_db2 TAG (); -- error
ERROR:  syntax error at or near ")"
LINE 1: CREATE DATABASE tag_db2 TAG ();
                                     ^
CREATE DATABASE tag_db2 TAG (tag1 = '');    -- error
ERROR:  tag value "" is not in tag "tag1" allowed values
CREATE DATABASE tag_db2 TAG (tag1 = 'val1', tag2 = '10');
CREATE DATABASE tag_db3 TAG (tag1 = 'val1', tag1 = 'val2', tag1 = 'val1');    -- error
ERROR:  tag "tag1" value has been added for object "tag_db3".
CREATE DATABASE tag_db3 TAG (tag1 = 'val1', tag1 = 'novalue');  -- error
ERROR:  tag value "novalue" is not in tag "tag1" allowed values
CREATE DATABASE tag_db3 TAG (tag1 = 'val1', tag2 = '1');
CREATE DATABASE tag_db4 TAG (tag1 = 'val1', tag2 = '3', tag4 = '');
CREATE DATABASE tag_db5 TAG (tag2 = '300', tag4 = ' ');
CREATE DATABASE tag_db6 TAG (tag4 = '', tag4 = ' '); -- error
ERROR:  tag "tag4" value has been added for object "tag_db6".
CREATE DATABASE tag_db6 TAG (tag4 = '', tag4 = ''); -- error
ERROR:  tag "tag4" value has been added for object "tag_db6".
CREATE DATABASE tag_db6 TAG (tag4 = ' ', tag4 = ' ');   -- error
ERROR:  tag "tag4" value has been added for object "tag_db6".
CREATE DATABASE tag_db6 TAG (tag4 = '');
CREATE DATABASE tag_db7 TAG (tag4 = ' ');
CREATE DATABASE tag_db8 TAG (tag3 = '');    -- error
ERROR:  tag value "" is not in tag "tag3" allowed values
CREATE DATABASE tag_db8 WITH TEMPLATE = template0 TAG (tag1 = 'novalue');   -- error
ERROR:  tag value "novalue" is not in tag "tag1" allowed values
CREATE DATABASE tag_db8 WITH TEMPLATE = template0 TAG (tag1 = 'val1');
CREATE DATABASE tag_db9 WITH TEMPLATE = template0;
CREATE DATABASE tag_db10 WITH TEMPLATE = template0 TAG (tag3 = 'dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef');
SELECT * FROM database_tag_descriptions
ORDER BY 1, 2, 3, 4;
 tddatabaseid | datname  | tagname |                                     tagvalue                                      
--------------+----------+---------+-----------------------------------------------------------------------------------
            0 | tag_db1  | tag1    | val1
            0 | tag_db10 | tag3    | dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef
            0 | tag_db2  | tag1    | val1
            0 | tag_db2  | tag2    | 10
            0 | tag_db3  | tag1    | val1
            0 | tag_db3  | tag2    | 1
            0 | tag_db4  | tag1    | val1
            0 | tag_db4  | tag2    | 3
            0 | tag_db4  | tag4    | 
            0 | tag_db5  | tag2    | 300
            0 | tag_db5  | tag4    |  
            0 | tag_db6  | tag4    | 
            0 | tag_db7  | tag4    |  
            0 | tag_db8  | tag1    | val1
(14 rows)

SELECT datname, datdba, encoding, datistemplate, datallowconn, datconnlimit
FROM pg_database
WHERE datname like '%tag%' ORDER BY 1;
 datname  | datdba | encoding | datistemplate | datallowconn | datconnlimit 
----------+--------+----------+---------------+--------------+--------------
 tag_db1  |     10 |        6 | f             | t            |           -1
 tag_db10 |     10 |        6 | f             | t            |           -1
 tag_db2  |     10 |        6 | f             | t            |           -1
 tag_db3  |     10 |        6 | f             | t            |           -1
 tag_db4  |     10 |        6 | f             | t            |           -1
 tag_db5  |     10 |        6 | f             | t            |           -1
 tag_db6  |     10 |        6 | f             | t            |           -1
 tag_db7  |     10 |        6 | f             | t            |           -1
 tag_db8  |     10 |        6 | f             | t            |           -1
 tag_db9  |     10 |        6 | f             | t            |           -1
(10 rows)

DROP TAG tag1;  -- error
ERROR:  tag "tag1" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag1
tag of tag description with tag tag1
tag of tag description with tag tag1
tag of tag description with tag tag1
tag of tag description with tag tag1
DROP TAG tag2;  -- error
ERROR:  tag "tag2" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag2
tag of tag description with tag tag2
tag of tag description with tag tag2
tag of tag description with tag tag2
DROP TAG tag3;  -- error
ERROR:  tag "tag3" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag3
DROP TAG tag4;  -- error
ERROR:  tag "tag4" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag4
tag of tag description with tag tag4
tag of tag description with tag tag4
tag of tag description with tag tag4
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            allowed_values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 tag1    |       10 | {val1,val2,val3}
 tag2    |       10 | {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300}
 tag3    |       10 | {dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef}
 tag4    |       10 | {123,456," ",""}
(4 rows)

-- Alter Database
ALTER DATABASE tag_db1 TAG (tag1 = 'val1', tag1 = 'val1');
ALTER DATABASE tag_db2 TAG (tag2 = '10');
ALTER DATABASE tag_db3 TAG (tag3 = ''); -- error
ERROR:  tag value "" is not in tag "tag3" allowed values
ALTER DATABASE tag_db4 UNSET TAG (tag1, tag2);
ALTER DATABASE tag_db4 TAG (tag1 = 'val3', tag4 = '');
WARNING:  object "tag_db4" does not have tag "tag1", creating
ALTER DATABASE tag_db5 TAG (tag4 = '', tag4 = ' ');
ALTER DATABASE tag_db6 TAG (tag4 = ' '); 
ALTER DATABASE tag_db7 TAG (tag1 = 'val2', tag2 = '3');
WARNING:  object "tag_db7" does not have tag "tag1", creating
WARNING:  object "tag_db7" does not have tag "tag2", creating
ALTER DATABASE tag_db7 UNSET TAG (tag1);
ALTER DATABASE tag_db8 TAG (tag4 = '123', tag4 = '123');
WARNING:  object "tag_db8" does not have tag "tag4", creating
ALTER DATABASE tag_db9 TAG (tag4 = '', tag4 = '123', tag4 = '456');
WARNING:  object "tag_db9" does not have tag "tag4", creating
ALTER DATABASE tag_db9 TAG (tag4 = '123');
SELECT * FROM database_tag_descriptions
ORDER BY 1, 2, 3, 4;
 tddatabaseid | datname  | tagname |                                     tagvalue                                      
--------------+----------+---------+-----------------------------------------------------------------------------------
            0 | tag_db1  | tag1    | val1
            0 | tag_db10 | tag3    | dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef
            0 | tag_db2  | tag1    | val1
            0 | tag_db2  | tag2    | 10
            0 | tag_db3  | tag1    | val1
            0 | tag_db3  | tag2    | 1
            0 | tag_db4  | tag1    | val3
            0 | tag_db4  | tag4    | 
            0 | tag_db5  | tag2    | 300
            0 | tag_db5  | tag4    |  
            0 | tag_db6  | tag4    |  
            0 | tag_db7  | tag2    | 3
            0 | tag_db7  | tag4    |  
            0 | tag_db8  | tag1    | val1
            0 | tag_db8  | tag4    | 123
            0 | tag_db9  | tag4    | 123
(16 rows)

SELECT datname, datdba, encoding, datistemplate, datallowconn, datconnlimit
FROM pg_database
WHERE datname like '%tag%' ORDER BY 1;
 datname  | datdba | encoding | datistemplate | datallowconn | datconnlimit 
----------+--------+----------+---------------+--------------+--------------
 tag_db1  |     10 |        6 | f             | t            |           -1
 tag_db10 |     10 |        6 | f             | t            |           -1
 tag_db2  |     10 |        6 | f             | t            |           -1
 tag_db3  |     10 |        6 | f             | t            |           -1
 tag_db4  |     10 |        6 | f             | t            |           -1
 tag_db5  |     10 |        6 | f             | t            |           -1
 tag_db6  |     10 |        6 | f             | t            |           -1
 tag_db7  |     10 |        6 | f             | t            |           -1
 tag_db8  |     10 |        6 | f             | t            |           -1
 tag_db9  |     10 |        6 | f             | t            |           -1
(10 rows)

-- Drop Database
DROP DATABASE tag_db1;
DROP DATABASE tag_db2;
DROP DATABASE tag_db3;
DROP DATABASE tag_db4;
DROP DATABASE tag_db5;
DROP DATABASE tag_db6;
DROP DATABASE tag_db7;
DROP DATABASE tag_db8;
DROP DATABASE tag_db9;
DROP DATABASE tag_db10;
SELECT * FROM database_tag_descriptions
ORDER BY 1, 2, 3, 4;
 tddatabaseid | datname | tagname | tagvalue 
--------------+---------+---------+----------
(0 rows)

SELECT datname, datdba, encoding, datistemplate, datallowconn, datconnlimit
FROM pg_database
WHERE datname like '%tag%' ORDER BY 1;
 datname | datdba | encoding | datistemplate | datallowconn | datconnlimit 
---------+--------+----------+---------------+--------------+--------------
(0 rows)

-- Test user with tag
-- Create User
CREATE USER tag_user1 TAG (tag1 = 'novalue'); -- error
NOTICE:  resource queue required -- using default resource queue "pg_default"
ERROR:  tag value "novalue" is not in tag "tag1" allowed values
CREATE USER tag_user1 TAG (tag1 = 'val1');
NOTICE:  resource queue required -- using default resource queue "pg_default"
CREATE USER tag_user2 TAG;    -- error
ERROR:  syntax error at or near ";"
LINE 1: CREATE USER tag_user2 TAG;
                                 ^
CREATE USER tag_user2 TAG (); -- error
ERROR:  syntax error at or near ")"
LINE 1: CREATE USER tag_user2 TAG ();
                                   ^
CREATE USER tag_user2 TAG (tag1 = '');    -- error
NOTICE:  resource queue required -- using default resource queue "pg_default"
ERROR:  tag value "" is not in tag "tag1" allowed values
CREATE USER tag_user2 TAG (tag1 = 'val1', tag2 = '10');
NOTICE:  resource queue required -- using default resource queue "pg_default"
CREATE USER tag_user3 TAG (tag1 = 'val1', tag1 = 'val2', tag1 = 'val1');    -- error
NOTICE:  resource queue required -- using default resource queue "pg_default"
ERROR:  tag "tag1" value has been added for object "tag_user3".
CREATE USER tag_user3 TAG (tag1 = 'val1', tag1 = 'novalue');  -- error
NOTICE:  resource queue required -- using default resource queue "pg_default"
ERROR:  tag value "novalue" is not in tag "tag1" allowed values
CREATE USER tag_user3 TAG (tag1 = 'val1', tag2 = '1');
NOTICE:  resource queue required -- using default resource queue "pg_default"
CREATE USER tag_user4 TAG (tag1 = 'val1', tag2 = '3', tag4 = '');
NOTICE:  resource queue required -- using default resource queue "pg_default"
CREATE USER tag_user5 TAG (tag2 = '300', tag4 = ' ');
NOTICE:  resource queue required -- using default resource queue "pg_default"
CREATE USER tag_user6 TAG (tag4 = '', tag4 = ''); -- error
NOTICE:  resource queue required -- using default resource queue "pg_default"
ERROR:  tag "tag4" value has been added for object "tag_user6".
CREATE USER tag_user6 TAG (tag4 = ' ', tag4 = ' ');   -- error
NOTICE:  resource queue required -- using default resource queue "pg_default"
ERROR:  tag "tag4" value has been added for object "tag_user6".
CREATE USER tag_user6 TAG (tag4 = '');
NOTICE:  resource queue required -- using default resource queue "pg_default"
CREATE USER tag_user7 CONNECTION LIMIT 10 TAG (tag4 = ' ');
NOTICE:  resource queue required -- using default resource queue "pg_default"
CREATE USER tag_user8 TAG (tag3 = '');    -- error
NOTICE:  resource queue required -- using default resource queue "pg_default"
ERROR:  tag value "" is not in tag "tag3" allowed values
CREATE USER tag_user8 superuser TAG (tag1 = 'novalue');   -- error
ERROR:  tag value "novalue" is not in tag "tag1" allowed values
CREATE USER tag_user8 superuser TAG (tag1 = 'val1');
CREATE USER tag_user9 superuser;
CREATE USER tag_user10 superuser TAG (tag3 = 'dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef');
SELECT * FROM user_tag_descriptions
WHERE rolname like '%tag_user%'
ORDER BY 1, 2, 3, 4;
 tddatabaseid |  rolname   | tagname |                                     tagvalue                                      
--------------+------------+---------+-----------------------------------------------------------------------------------
            0 | tag_user1  | tag1    | val1
            0 | tag_user10 | tag3    | dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef
            0 | tag_user2  | tag1    | val1
            0 | tag_user2  | tag2    | 10
            0 | tag_user3  | tag1    | val1
            0 | tag_user3  | tag2    | 1
            0 | tag_user4  | tag1    | val1
            0 | tag_user4  | tag2    | 3
            0 | tag_user4  | tag4    | 
            0 | tag_user5  | tag2    | 300
            0 | tag_user5  | tag4    |  
            0 | tag_user6  | tag4    | 
            0 | tag_user7  | tag4    |  
            0 | tag_user8  | tag1    | val1
(14 rows)

SELECT rolname, rolsuper, rolconnlimit FROM pg_authid
WHERE rolname like '%tag_user%'
ORDER BY 1;
  rolname   | rolsuper | rolconnlimit 
------------+----------+--------------
 tag_user1  | f        |           -1
 tag_user10 | t        |           -1
 tag_user2  | f        |           -1
 tag_user3  | f        |           -1
 tag_user4  | f        |           -1
 tag_user5  | f        |           -1
 tag_user6  | f        |           -1
 tag_user7  | f        |           10
 tag_user8  | t        |           -1
 tag_user9  | t        |           -1
(10 rows)

DROP TAG tag1;  -- error
ERROR:  tag "tag1" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag1
tag of tag description with tag tag1
tag of tag description with tag tag1
tag of tag description with tag tag1
tag of tag description with tag tag1
DROP TAG tag2;  -- error
ERROR:  tag "tag2" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag2
tag of tag description with tag tag2
tag of tag description with tag tag2
tag of tag description with tag tag2
DROP TAG tag3;  -- error
ERROR:  tag "tag3" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag3
DROP TAG tag4;  -- error
ERROR:  tag "tag4" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag4
tag of tag description with tag tag4
tag of tag description with tag tag4
tag of tag description with tag tag4
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            allowed_values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 tag1    |       10 | {val1,val2,val3}
 tag2    |       10 | {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300}
 tag3    |       10 | {dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef}
 tag4    |       10 | {123,456," ",""}
(4 rows)

-- Alter User
ALTER USER tag_user1 CONNECTION LIMIT 3 TAG (tag1 = 'val1', tag1 = 'val1'); -- error
ERROR:  syntax error at or near "TAG"
LINE 1: ALTER USER tag_user1 CONNECTION LIMIT 3 TAG (tag1 = 'val1', ...
                                                ^
ALTER USER tag_user1 TAG (tag1 = 'val1', tag1 = 'val1');
ALTER USER tag_user2 TAG (tag2 = '10');
ALTER USER tag_user3 TAG (tag3 = ''); -- error
ERROR:  tag value "" is not in tag "tag3" allowed values
ALTER USER tag_user4 UNSET TAG (tag1, tag2);
ALTER USER tag_user4 TAG (tag1 = 'val3', tag4 = '');
WARNING:  object "tag_user4" does not have tag "tag1", creating
ALTER USER tag_user5 TAG (tag4 = '', tag4 = ' ');
ALTER USER tag_user6 TAG (tag4 = ' '); 
ALTER USER tag_user7 TAG (tag1 = 'val2', tag2 = '3');
WARNING:  object "tag_user7" does not have tag "tag1", creating
WARNING:  object "tag_user7" does not have tag "tag2", creating
ALTER USER tag_user7 UNSET TAG (tag1);
ALTER USER tag_user8 TAG (tag4 = '123', tag4 = '123');
WARNING:  object "tag_user8" does not have tag "tag4", creating
ALTER USER tag_user9 TAG (tag4 = '', tag4 = '123', tag4 = '456');
WARNING:  object "tag_user9" does not have tag "tag4", creating
ALTER USER tag_user9 TAG (tag4 = '123');
SELECT * FROM user_tag_descriptions
WHERE rolname like '%tag_user%'
ORDER BY 1, 2, 3, 4;
 tddatabaseid |  rolname   | tagname |                                     tagvalue                                      
--------------+------------+---------+-----------------------------------------------------------------------------------
            0 | tag_user1  | tag1    | val1
            0 | tag_user10 | tag3    | dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef
            0 | tag_user2  | tag1    | val1
            0 | tag_user2  | tag2    | 10
            0 | tag_user3  | tag1    | val1
            0 | tag_user3  | tag2    | 1
            0 | tag_user4  | tag1    | val3
            0 | tag_user4  | tag4    | 
            0 | tag_user5  | tag2    | 300
            0 | tag_user5  | tag4    |  
            0 | tag_user6  | tag4    |  
            0 | tag_user7  | tag2    | 3
            0 | tag_user7  | tag4    |  
            0 | tag_user8  | tag1    | val1
            0 | tag_user8  | tag4    | 123
            0 | tag_user9  | tag4    | 123
(16 rows)

SELECT rolname, rolsuper, rolconnlimit FROM pg_authid
WHERE rolname like '%tag_user%'
ORDER BY 1;
  rolname   | rolsuper | rolconnlimit 
------------+----------+--------------
 tag_user1  | f        |           -1
 tag_user10 | t        |           -1
 tag_user2  | f        |           -1
 tag_user3  | f        |           -1
 tag_user4  | f        |           -1
 tag_user5  | f        |           -1
 tag_user6  | f        |           -1
 tag_user7  | f        |           10
 tag_user8  | t        |           -1
 tag_user9  | t        |           -1
(10 rows)

-- Drop User
DROP USER tag_user1;
DROP USER tag_user2;
DROP USER tag_user3;
DROP USER tag_user4;
DROP USER tag_user5;
DROP USER tag_user6;
DROP USER tag_user7;
DROP USER tag_user8;
DROP USER tag_user9;
DROP USER tag_user10;
SELECT * FROM user_tag_descriptions
WHERE rolname like '%tag_user%'
ORDER BY 1, 2, 3, 4;
 tddatabaseid | rolname | tagname | tagvalue 
--------------+---------+---------+----------
(0 rows)

SELECT rolname, rolsuper, rolconnlimit FROM pg_authid
WHERE rolname like '%tag_user%'
ORDER BY 1;
 rolname | rolsuper | rolconnlimit 
---------+----------+--------------
(0 rows)

-- Test tablespace with tag
-- Create tablespace
CREATE TABLESPACE tag_tablespace LOCATION '@testtablespace@' WITH (random_page_cost = 3.0) TAG (tag1 = 'test'); -- error
ERROR:  tag value "test" is not in tag "tag1" allowed values
CREATE TABLESPACE tag_tablespace LOCATION '@testtablespace@' WITH (random_page_cost = 3.0) TAG (tag1 = 'val1', tag2 = '301');   -- error
ERROR:  tag value "301" is not in tag "tag2" allowed values
CREATE TABLESPACE tag_tablespace LOCATION '@testtablespace@' WITH (random_page_cost = 3.0) TAG (tag1 = 'val1', tag2 = '2');
SELECT * FROM tablespace_tag_descriptions
ORDER BY 1, 2, 3, 4;
 tddatabaseid |    spcname     | tagname | tagvalue 
--------------+----------------+---------+----------
            0 | tag_tablespace | tag1    | val1
            0 | tag_tablespace | tag2    | 2
(2 rows)

SELECT spcname FROM pg_tablespace
ORDER BY 1;
    spcname     
----------------
 pg_default
 pg_global
 tag_tablespace
(3 rows)

-- Alter tablespace
ALTER TABLESPACE tag_tablespace SET (random_page_cost = 1.0, seq_page_cost = 1.1) TAG (tag2 = '10');    -- error
ERROR:  syntax error at or near "TAG"
LINE 1: ...SET (random_page_cost = 1.0, seq_page_cost = 1.1) TAG (tag2 ...
                                                             ^
ALTER TABLESPACE tag_tablespace SET (random_page_cost = 1.0, seq_page_cost = 1.1) TAG (tag3 = ''); -- error
ERROR:  syntax error at or near "TAG"
LINE 1: ...SET (random_page_cost = 1.0, seq_page_cost = 1.1) TAG (tag3 ...
                                                             ^
ALTER TABLESPACE tag_tablespace SET (random_page_cost = 1.0, seq_page_cost = 1.1) TAG (tag4 = '', tag1 = 'val1');   -- error
ERROR:  syntax error at or near "TAG"
LINE 1: ...SET (random_page_cost = 1.0, seq_page_cost = 1.1) TAG (tag4 ...
                                                             ^
ALTER TABLESPACE tag_tablespace TAG (tag4 = '', tag1 = 'val1');
WARNING:  object "tag_tablespace" does not have tag "tag4", creating
ALTER TABLESPACE tag_tablespace UNSET TAG (tag1, tag2);
ALTER TABLESPACE tag_tablespace UNSET TAG (tag2);
ERROR:  object "tag_tablespace" does not have tag "tag2"
ALTER TABLESPACE tag_tablespace TAG (tag2 = '10');
WARNING:  object "tag_tablespace" does not have tag "tag2", creating
ALTER TABLESPACE tag_tablespace TAG (tag1 = 'val2', tag1 = 'val3');
WARNING:  object "tag_tablespace" does not have tag "tag1", creating
SELECT * FROM tablespace_tag_descriptions
ORDER BY 1, 2, 3, 4;
 tddatabaseid |    spcname     | tagname | tagvalue 
--------------+----------------+---------+----------
            0 | tag_tablespace | tag1    | val3
            0 | tag_tablespace | tag2    | 10
            0 | tag_tablespace | tag4    | 
(3 rows)

SELECT spcname FROM pg_tablespace
ORDER BY 1;
    spcname     
----------------
 pg_default
 pg_global
 tag_tablespace
(3 rows)

DROP TAG tag1;  -- error
ERROR:  tag "tag1" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag1
DROP TAG tag2;  -- error
ERROR:  tag "tag2" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag2
DROP TAG tag4;  -- error
ERROR:  tag "tag4" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag4
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            allowed_values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 tag1    |       10 | {val1,val2,val3}
 tag2    |       10 | {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300}
 tag3    |       10 | {dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef}
 tag4    |       10 | {123,456," ",""}
(4 rows)

-- Drop tablespace
DROP TABLESPACE tag_tablespace;
SELECT * FROM tablespace_tag_descriptions
ORDER BY 1, 2, 3, 4;
 tddatabaseid | spcname | tagname | tagvalue 
--------------+---------+---------+----------
(0 rows)

SELECT spcname FROM pg_tablespace
ORDER BY 1;
  spcname   
------------
 pg_default
 pg_global
(2 rows)

-- Test Schema with Tag
-- Create Schema
CREATE SCHEMA tag_schema1 TAG (tag1 = 'val1');  -- error
ERROR:  syntax error at or near "TAG"
LINE 1: CREATE SCHEMA tag_schema1 TAG (tag1 = 'val1');
                                  ^
CREATE SCHEMA tag_schema1 WITH TAG (tag1 = 'novalue'); -- error
ERROR:  tag value "novalue" is not in tag "tag1" allowed values
CREATE SCHEMA tag_schema1 WITH TAG (tag1 = 'val1');
CREATE SCHEMA tag_schema2 WITH TAG;    -- error
ERROR:  syntax error at or near ";"
LINE 1: CREATE SCHEMA tag_schema2 WITH TAG;
                                          ^
CREATE SCHEMA tag_schema2 WITH TAG (); -- error
ERROR:  syntax error at or near ")"
LINE 1: CREATE SCHEMA tag_schema2 WITH TAG ();
                                            ^
CREATE SCHEMA tag_schema2 WITH TAG (tag1 = '');    -- error
ERROR:  tag value "" is not in tag "tag1" allowed values
CREATE SCHEMA tag_schema2 WITH TAG (tag1 = 'val1', tag2 = '10');
CREATE SCHEMA tag_schema3 WITH TAG (tag1 = 'val1', tag1 = 'val2', tag1 = 'val1');    -- error
ERROR:  tag "tag1" value has been added for object "tag_schema3".
CREATE SCHEMA tag_schema3 WITH TAG (tag1 = 'val1', tag1 = 'novalue');  -- error
ERROR:  tag value "novalue" is not in tag "tag1" allowed values
CREATE SCHEMA tag_schema3 WITH TAG (tag1 = 'val1', tag2 = '1');
CREATE SCHEMA tag_schema4 WITH TAG (tag1 = 'val1', tag2 = '3', tag4 = '');
CREATE SCHEMA tag_schema5 WITH TAG (tag2 = '300', tag4 = ' ');
CREATE SCHEMA tag_schema6 WITH TAG (tag4 = '', tag4 = ''); -- error
ERROR:  tag "tag4" value has been added for object "tag_schema6".
CREATE SCHEMA tag_schema6 WITH TAG (tag4 = ' ', tag4 = ' ');   -- error
ERROR:  tag "tag4" value has been added for object "tag_schema6".
CREATE SCHEMA tag_schema6 WITH TAG (tag4 = '');
CREATE SCHEMA tag_schema7 WITH TAG (tag4 = ' ');
CREATE SCHEMA tag_schema8 WITH TAG (tag3 = '');    -- error
ERROR:  tag value "" is not in tag "tag3" allowed values
CREATE SCHEMA tag_schema8 WITH TAG (tag1 = 'novalue');   -- error
ERROR:  tag value "novalue" is not in tag "tag1" allowed values
CREATE SCHEMA tag_schema8 WITH TAG (tag1 = 'val1');
CREATE SCHEMA tag_schema9;
CREATE SCHEMA tag_schema10 WITH TAG (tag3 = 'dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef');
SELECT * FROM schema_tag_descriptions
WHERE nspname like '%tag_schema%'
ORDER BY 1, 2, 3, 4;
 datname  |   nspname    | tagname |                                     tagvalue                                      
----------+--------------+---------+-----------------------------------------------------------------------------------
 postgres | tag_schema1  | tag1    | val1
 postgres | tag_schema10 | tag3    | dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef
 postgres | tag_schema2  | tag1    | val1
 postgres | tag_schema2  | tag2    | 10
 postgres | tag_schema3  | tag1    | val1
 postgres | tag_schema3  | tag2    | 1
 postgres | tag_schema4  | tag1    | val1
 postgres | tag_schema4  | tag2    | 3
 postgres | tag_schema4  | tag4    | 
 postgres | tag_schema5  | tag2    | 300
 postgres | tag_schema5  | tag4    |  
 postgres | tag_schema6  | tag4    | 
 postgres | tag_schema7  | tag4    |  
 postgres | tag_schema8  | tag1    | val1
(14 rows)

SELECT nspname, nspowner FROM pg_namespace
WHERE nspname like '%tag_schema%'
ORDER BY 1;
   nspname    | nspowner 
--------------+----------
 tag_schema1  |       10
 tag_schema10 |       10
 tag_schema2  |       10
 tag_schema3  |       10
 tag_schema4  |       10
 tag_schema5  |       10
 tag_schema6  |       10
 tag_schema7  |       10
 tag_schema8  |       10
 tag_schema9  |       10
(10 rows)

DROP TAG tag1;  -- error
ERROR:  tag "tag1" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag1
tag of tag description with tag tag1
tag of tag description with tag tag1
tag of tag description with tag tag1
tag of tag description with tag tag1
DROP TAG tag2;  -- error
ERROR:  tag "tag2" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag2
tag of tag description with tag tag2
tag of tag description with tag tag2
tag of tag description with tag tag2
DROP TAG tag3;  -- error
ERROR:  tag "tag3" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag3
DROP TAG tag4;  -- error
ERROR:  tag "tag4" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag4
tag of tag description with tag tag4
tag of tag description with tag tag4
tag of tag description with tag tag4
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            allowed_values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 tag1    |       10 | {val1,val2,val3}
 tag2    |       10 | {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300}
 tag3    |       10 | {dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef}
 tag4    |       10 | {123,456," ",""}
(4 rows)

-- Alter Schema
ALTER SCHEMA tag_schema1 TAG (tag1 = 'val1', tag1 = 'val1');
ALTER SCHEMA tag_schema2 TAG (tag2 = '10');
ALTER SCHEMA tag_schema3 TAG (tag3 = ''); -- error
ERROR:  tag value "" is not in tag "tag3" allowed values
ALTER SCHEMA tag_schema4 UNSET TAG (tag1, tag2);
ALTER SCHEMA tag_schema4 TAG (tag1 = 'val3', tag4 = '');
WARNING:  object "tag_schema4" does not have tag "tag1", creating
ALTER SCHEMA tag_schema5 TAG (tag4 = '', tag4 = ' ');
ALTER SCHEMA tag_schema6 TAG (tag4 = ' '); 
ALTER SCHEMA tag_schema7 TAG (tag1 = 'val2', tag2 = '3');
WARNING:  object "tag_schema7" does not have tag "tag1", creating
WARNING:  object "tag_schema7" does not have tag "tag2", creating
ALTER SCHEMA tag_schema7 UNSET TAG (tag1);
ALTER SCHEMA tag_schema8 TAG (tag4 = '123', tag4 = '123');
WARNING:  object "tag_schema8" does not have tag "tag4", creating
ALTER SCHEMA tag_schema9 TAG (tag4 = '', tag4 = '123', tag4 = '456');
WARNING:  object "tag_schema9" does not have tag "tag4", creating
ALTER SCHEMA tag_schema9 TAG (tag4 = '123');
SELECT * FROM schema_tag_descriptions
WHERE nspname like '%tag_schema%'
ORDER BY 1, 2, 3, 4;
 datname  |   nspname    | tagname |                                     tagvalue                                      
----------+--------------+---------+-----------------------------------------------------------------------------------
 postgres | tag_schema1  | tag1    | val1
 postgres | tag_schema10 | tag3    | dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef
 postgres | tag_schema2  | tag1    | val1
 postgres | tag_schema2  | tag2    | 10
 postgres | tag_schema3  | tag1    | val1
 postgres | tag_schema3  | tag2    | 1
 postgres | tag_schema4  | tag1    | val3
 postgres | tag_schema4  | tag4    | 
 postgres | tag_schema5  | tag2    | 300
 postgres | tag_schema5  | tag4    |  
 postgres | tag_schema6  | tag4    |  
 postgres | tag_schema7  | tag2    | 3
 postgres | tag_schema7  | tag4    |  
 postgres | tag_schema8  | tag1    | val1
 postgres | tag_schema8  | tag4    | 123
 postgres | tag_schema9  | tag4    | 123
(16 rows)

SELECT nspname, nspowner FROM pg_namespace
WHERE nspname like '%tag_schema%'
ORDER BY 1;
   nspname    | nspowner 
--------------+----------
 tag_schema1  |       10
 tag_schema10 |       10
 tag_schema2  |       10
 tag_schema3  |       10
 tag_schema4  |       10
 tag_schema5  |       10
 tag_schema6  |       10
 tag_schema7  |       10
 tag_schema8  |       10
 tag_schema9  |       10
(10 rows)

-- Drop Schema
DROP SCHEMA tag_schema1;
DROP SCHEMA tag_schema2;
DROP SCHEMA tag_schema3;
DROP SCHEMA tag_schema4;
DROP SCHEMA tag_schema5;
DROP SCHEMA tag_schema6;
DROP SCHEMA tag_schema7;
DROP SCHEMA tag_schema8;
DROP SCHEMA tag_schema9;
DROP SCHEMA tag_schema10;
SELECT * FROM schema_tag_descriptions
WHERE nspname like '%tag_schema%'
ORDER BY 1, 2, 3, 4;
 datname | nspname | tagname | tagvalue 
---------+---------+---------+----------
(0 rows)

SELECT nspname, nspowner FROM pg_namespace
WHERE nspname like '%tag_schema%'
ORDER BY 1;
 nspname | nspowner 
---------+----------
(0 rows)

-- Test Table with Tag
-- Create Table
CREATE TABLE tag_table1(a int, b varchar) TAG (tag1 = 'novalue'); -- error
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
ERROR:  tag value "novalue" is not in tag "tag1" allowed values
CREATE TEMP TABLE tag_table1(a int, b varchar) TAG (tag1 = 'val1');
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
CREATE TEMP TABLE tag_table2(a int, b varchar) TAG;    -- error
ERROR:  syntax error at or near ";"
LINE 1: CREATE TEMP TABLE tag_table2(a int, b varchar) TAG;
                                                          ^
CREATE TEMP TABLE tag_table2(a int, b varchar) TAG (); -- error
ERROR:  syntax error at or near ")"
LINE 1: CREATE TEMP TABLE tag_table2(a int, b varchar) TAG ();
                                                            ^
CREATE TABLE tag_table2(a int, b varchar) TAG (tag1 = '');    -- error
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
ERROR:  tag value "" is not in tag "tag1" allowed values
CREATE TEMP TABLE tag_table2(a int, b varchar) TAG (tag1 = 'val1', tag2 = '10');
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
CREATE TABLE tag_table3(a int, b varchar) TAG (tag1 = 'val1', tag1 = 'val2', tag1 = 'val1');    -- error
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
ERROR:  tag "tag1" value has been added for object "tag_table3".
CREATE TABLE tag_table3(a int, b varchar) TAG (tag1 = 'val1', tag1 = 'novalue');  -- error
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
ERROR:  tag value "novalue" is not in tag "tag1" allowed values
CREATE TEMP TABLE tag_table3(a int, b varchar) TAG (tag1 = 'val1', tag2 = '1');
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
CREATE TABLE tag_table4(a int, b varchar) TAG (tag1 = 'val1', tag2 = '3', tag4 = '');
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
CREATE TABLE tag_table5(a int, b varchar) TAG (tag2 = '300', tag4 = ' ');
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
CREATE TABLE tag_table6(a int, b varchar) TAG (tag4 = '', tag4 = ''); -- error
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
ERROR:  tag "tag4" value has been added for object "tag_table6".
CREATE TABLE tag_table6(a int, b varchar) TAG (tag4 = ' ', tag4 = ' ');   -- error
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
ERROR:  tag "tag4" value has been added for object "tag_table6".
CREATE TABLE tag_table6(a int, b varchar) TAG (tag4 = '');
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
CREATE TABLE tag_table7(a int, b varchar) TAG (tag4 = ' ');
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
CREATE TABLE tag_table8(a int, b varchar) TAG (tag3 = '');    -- error
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
ERROR:  tag value "" is not in tag "tag3" allowed values
CREATE TABLE tag_table8(a int, b varchar) TAG (tag1 = 'novalue');   -- error
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
ERROR:  tag value "novalue" is not in tag "tag1" allowed values
CREATE TABLE tag_table8(a int, b varchar) TAG (tag1 = 'val1');
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
CREATE TABLE tag_table9(a int, b varchar);
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
CREATE TABLE tag_table10(a int, b varchar) TAG (tag3 = 'dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef');
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Apache Cloudberry data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
SELECT * FROM relation_tag_descriptions
WHERE relname like '%tag_table%'
ORDER BY 1, 2, 3, 4, 5, 6;
 datname  |   relname   | relnamespace | relkind | tagname |                                     tagvalue                                      
----------+-------------+--------------+---------+---------+-----------------------------------------------------------------------------------
 postgres | tag_table10 | public       | r       | tag3    | dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef
 postgres | tag_table4  | public       | r       | tag1    | val1
 postgres | tag_table4  | public       | r       | tag2    | 3
 postgres | tag_table4  | public       | r       | tag4    | 
 postgres | tag_table5  | public       | r       | tag2    | 300
 postgres | tag_table5  | public       | r       | tag4    |  
 postgres | tag_table6  | public       | r       | tag4    | 
 postgres | tag_table7  | public       | r       | tag4    |  
 postgres | tag_table8  | public       | r       | tag1    | val1
(9 rows)

SELECT relname, relpersistence FROM pg_class
WHERE relname like '%tag_table%'
ORDER BY 1;
   relname   | relpersistence 
-------------+----------------
 tag_table1  | t
 tag_table10 | p
 tag_table2  | t
 tag_table3  | t
 tag_table4  | p
 tag_table5  | p
 tag_table6  | p
 tag_table7  | p
 tag_table8  | p
 tag_table9  | p
(10 rows)

DROP TAG tag1;  -- error
ERROR:  tag "tag1" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag1
tag of tag description with tag tag1
DROP TAG tag2;  -- error
ERROR:  tag "tag2" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag2
tag of tag description with tag tag2
DROP TAG tag3;  -- error
ERROR:  tag "tag3" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag3
DROP TAG tag4;  -- error
ERROR:  tag "tag4" cannot be dropped because some objects depend on it
DETAIL:  tag of tag description with tag tag4
tag of tag description with tag tag4
tag of tag description with tag tag4
tag of tag description with tag tag4
SELECT tagname, tagowner, allowed_values FROM pg_tag ORDER BY 1;
 tagname | tagowner |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            allowed_values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 tag1    |       10 | {val1,val2,val3}
 tag2    |       10 | {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300}
 tag3    |       10 | {dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef}
 tag4    |       10 | {123,456," ",""}
(4 rows)

-- Alter Table
ALTER TABLE tag_table1 TAG (tag1 = 'val1', tag1 = 'val1');
ALTER TABLE tag_table2 TAG (tag2 = '10');
ALTER TABLE tag_table3 TAG (tag3 = '');
ALTER TABLE tag_table4 UNSET TAG (tag1, tag2);
ALTER TABLE tag_table4 TAG (tag1 = 'val3', tag4 = '');
WARNING:  object "tag_table4" does not have tag "tag1", creating
ALTER TABLE tag_table5 TAG (tag4 = '', tag4 = ' ');
ALTER TABLE tag_table6 TAG (tag4 = ' '); 
ALTER TABLE tag_table7 TAG (tag1 = 'val2', tag2 = '3');
WARNING:  object "tag_table7" does not have tag "tag1", creating
WARNING:  object "tag_table7" does not have tag "tag2", creating
ALTER TABLE tag_table7 UNSET TAG (tag1);
ALTER TABLE tag_table8 TAG (tag4 = '123', tag4 = '123');
WARNING:  object "tag_table8" does not have tag "tag4", creating
ALTER TABLE tag_table9 TAG (tag4 = '', tag4 = '123', tag4 = '456');
WARNING:  object "tag_table9" does not have tag "tag4", creating
ALTER TABLE tag_table9 TAG (tag4 = '123');
SELECT * FROM relation_tag_descriptions
WHERE relname like '%tag_table%'
ORDER BY 1, 2, 3, 4, 5, 6;
 datname  |   relname   | relnamespace | relkind | tagname |                                     tagvalue                                      
----------+-------------+--------------+---------+---------+-----------------------------------------------------------------------------------
 postgres | tag_table10 | public       | r       | tag3    | dadkqjefpqfqfqe4l123j9i1snkqenp3412n4jnflqjenfaddpiqepj21304i12;kfnqpqnepfqefqwef
 postgres | tag_table4  | public       | r       | tag1    | val3
 postgres | tag_table4  | public       | r       | tag4    | 
 postgres | tag_table5  | public       | r       | tag2    | 300
 postgres | tag_table5  | public       | r       | tag4    |  
 postgres | tag_table6  | public       | r       | tag4    |  
 postgres | tag_table7  | public       | r       | tag2    | 3
 postgres | tag_table7  | public       | r       | tag4    |  
 postgres | tag_table8  | public       | r       | tag1    | val1
 postgres | tag_table8  | public       | r       | tag4    | 123
 postgres | tag_table9  | public       | r       | tag4    | 123
(11 rows)

SELECT relname, relpersistence FROM pg_class
WHERE relname like '%tag_table%'
ORDER BY 1;
   relname   | relpersistence 
-------------+----------------
 tag_table1  | t
 tag_table10 | p
 tag_table2  | t
 tag_table3  | t
 tag_table4  | p
 tag_table5  | p
 tag_table6  | p
 tag_table7  | p
 tag_table8  | p
 tag_table9  | p
(10 rows)

-- Drop Table
DROP TABLE tag_table1;
DROP TABLE tag_table2;
DROP TABLE tag_table3;
DROP TABLE tag_table4;
DROP TABLE tag_table5;
DROP TABLE tag_table6;
DROP TABLE tag_table7;
DROP TABLE tag_table8;
DROP TABLE tag_table9;
DROP TABLE tag_table10;
SELECT * FROM relation_tag_descriptions
WHERE relname like '%tag_table%'
ORDER BY 1, 2, 3, 4, 5, 6;
 datname | relname | relnamespace | relkind | tagname | tagvalue 
---------+---------+--------------+---------+---------+----------
(0 rows)

SELECT relname, relpersistence FROM pg_class
WHERE relname like '%tag_table%'
ORDER BY 1;
 relname | relpersistence 
---------+----------------
(0 rows)

-- Test tag with null allowed_values
CREATE TAG tag_with_null_values;
CREATE DATABASE test TAG (tag_with_null_values = '123');
ALTER DATABASE test TAG (tag_with_null_values = 'qweda');
DROP TAG tag_with_null_values;	-- error
DETAIL:  tag of tag description with tag tag_with_null_values
ERROR:  tag "tag_with_null_values" cannot be dropped because some objects depend on it
DROP DATABASE test;
-- Cleanup
DROP TAG tag1;
DROP TAG tag2;
DROP TAG tag3;
DROP TAG tag4;
DROP TAG tag_with_null_values;
DROP DATABASE other_db;
